<!DOCTYPE html>
<html lang="zh-Hans">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="description" content="线程池的介绍及使用学习笔记"/>




  <meta name="keywords" content="多线程," />





  <link rel="alternate" href="/default" title="Time is the only currency" >




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.1" />



<link rel="canonical" href="http://example.com/2022/03/09/线程池的介绍及使用/"/>


<meta name="description" content="一、使用线程池的优势线程池的主要目的是控制运行的线程的数量，处理过程中将任务放入队列，然后在线程创建后启动这些任务，如果线程数量超过了最大数量，超出数量的线程排队等候，等其他线程执行完毕，在从队列中取出任务来执行。 线程池的主要特点是：线程可以复用，可以控制最大并发数，管理线程。 优势主要有以下几点： 第一、降低资源消耗。通过重复利用已创建的线程降低线程创建和销毁造成的消耗； 第二、提高响应速度。">
<meta property="og:type" content="article">
<meta property="og:title" content="线程池的介绍及使用学习笔记">
<meta property="og:url" content="http://example.com/2022/03/09/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%8F%8A%E4%BD%BF%E7%94%A8/index.html">
<meta property="og:site_name" content="Time is the only currency">
<meta property="og:description" content="一、使用线程池的优势线程池的主要目的是控制运行的线程的数量，处理过程中将任务放入队列，然后在线程创建后启动这些任务，如果线程数量超过了最大数量，超出数量的线程排队等候，等其他线程执行完毕，在从队列中取出任务来执行。 线程池的主要特点是：线程可以复用，可以控制最大并发数，管理线程。 优势主要有以下几点： 第一、降低资源消耗。通过重复利用已创建的线程降低线程创建和销毁造成的消耗； 第二、提高响应速度。">
<meta property="og:locale">
<meta property="og:image" content="https://raw.githubusercontent.com/calm-always/picture/main/img/image-20220309232255825.png">
<meta property="og:image" content="https://raw.githubusercontent.com/calm-always/picture/main/img/image-20220309232956284.png">
<meta property="og:image" content="https://raw.githubusercontent.com/calm-always/picture/main/img/image-20220309233153651.png">
<meta property="og:image" content="https://raw.githubusercontent.com/calm-always/picture/main/img/image-20220309233315918.png">
<meta property="og:image" content="https://raw.githubusercontent.com/calm-always/picture/main/img/image-20220309233733219.png">
<meta property="og:image" content="https://raw.githubusercontent.com/calm-always/picture/main/img/image-20220309233752742.png">
<meta property="og:image" content="https://raw.githubusercontent.com/calm-always/picture/main/img/image-20220309233818875.png">
<meta property="og:image" content="https://raw.githubusercontent.com/calm-always/picture/main/img/image-20220309234004688.png">
<meta property="og:image" content="https://raw.githubusercontent.com/calm-always/picture/main/img/image-20220310000525432.png">
<meta property="og:image" content="https://raw.githubusercontent.com/calm-always/picture/main/img/image-20220310000628524.png">
<meta property="og:image" content="https://raw.githubusercontent.com/calm-always/picture/main/img/image-20220309233733219.png">
<meta property="og:image" content="https://raw.githubusercontent.com/calm-always/picture/main/img/image-20220309233752742.png">
<meta property="og:image" content="https://raw.githubusercontent.com/calm-always/picture/main/img/image-20220309233818875.png">
<meta property="article:published_time" content="2022-03-09T14:53:27.000Z">
<meta property="article:modified_time" content="2022-03-09T16:31:06.232Z">
<meta property="article:author" content="zjh">
<meta property="article:tag" content="多线程">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/calm-always/picture/main/img/image-20220309232255825.png">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1" />
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  



    <title> 线程池的介绍及使用学习笔记 - Time is the only currency </title>
  <meta name="generator" content="Hexo 5.4.0"></head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">Time is the only currency</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          线程池的介绍及使用学习笔记
        
      </h1>

      <time class="post-time">
          Mar 09 2022
      </time>
    </header>



    
            <div class="post-content">
            <h4 id="一、使用线程池的优势"><a href="#一、使用线程池的优势" class="headerlink" title="一、使用线程池的优势"></a>一、使用线程池的优势</h4><p>线程池的主要目的是控制运行的线程的数量，处理过程中将任务放入队列，然后在线程创建后启动这些任务，如果线程数量超过了最大数量，超出数量的线程排队等候，等其他线程执行完毕，在从队列中取出任务来执行。</p>
<p>线程池的主要特点是：线程可以复用，可以控制最大并发数，管理线程。</p>
<p>优势主要有以下几点：</p>
<p>第一、降低资源消耗。通过重复利用已创建的线程降低线程创建和销毁造成的消耗；</p>
<p>第二、提高响应速度。当任务到达时，任务可以不需要等到线程创建就能立即执行；</p>
<p>第三、提高线程的可管理性。线程是稀缺资源，如果无限制的创建，不仅会消耗系统资源，还会降低系统的稳定性，使用线程池可以进行统一的分配，调优和监控。</p>
<h4 id="二、线程池的常用方式"><a href="#二、线程池的常用方式" class="headerlink" title="二、线程池的常用方式"></a>二、线程池的常用方式</h4><p><img src="https://raw.githubusercontent.com/calm-always/picture/main/img/image-20220309232255825.png" alt="image-20220309232255825"></p>
<h5 id="1-固定线程数线程池"><a href="#1-固定线程数线程池" class="headerlink" title="1.固定线程数线程池"></a>1.固定线程数线程池</h5><p>适合执行长期的任务，性能较好</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService threadPool = Executors.newFixedThreadPool(<span class="number">5</span>); <span class="comment">//有5个线程的线程池</span></span><br><span class="line">        <span class="comment">//模拟10个用户来办理业务，每个用户就是一个来自外部的请求线程</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">            threadPool.execute(() -&gt; &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">&quot;, \t办理业务&quot;</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/calm-always/picture/main/img/image-20220309232956284.png" alt="image-20220309232956284"></p>
<h5 id="2-只有一个线程的线程池"><a href="#2-只有一个线程的线程池" class="headerlink" title="2.只有一个线程的线程池"></a>2.只有一个线程的线程池</h5><p>适合一个任务一个任务执行的场景</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService threadPool = Executors.newSingleThreadExecutor();<span class="comment">//一次一线程</span></span><br><span class="line">        <span class="comment">//模拟10个用户来办理业务，每个用户就是一个来自外部的请求线程</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">            threadPool.execute(() -&gt; &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">&quot;, \t办理业务&quot;</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        threadPool.shutdown();</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/calm-always/picture/main/img/image-20220309233153651.png" alt="image-20220309233153651"></p>
<h5 id="3-可缓存线程池"><a href="#3-可缓存线程池" class="headerlink" title="3.可缓存线程池"></a>3.可缓存线程池</h5><p>适合执行很多短期异步的小程序或者负载较轻的服务器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService threadPool = Executors.newCachedThreadPool();<span class="comment">//可缓存线程池</span></span><br><span class="line">        <span class="comment">//模拟10个用户来办理业务，每个用户就是一个来自外部的请求线程</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">            threadPool.execute(() -&gt; &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">&quot;, \t办理业务&quot;</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        threadPool.shutdown();</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/calm-always/picture/main/img/image-20220309233315918.png" alt="image-20220309233315918"></p>
<h4 id="三、线程池的七大参数"><a href="#三、线程池的七大参数" class="headerlink" title="三、线程池的七大参数"></a>三、线程池的七大参数</h4><p><img src="https://raw.githubusercontent.com/calm-always/picture/main/img/image-20220309233733219.png" alt="image-20220309233733219"></p>
<p><img src="https://raw.githubusercontent.com/calm-always/picture/main/img/image-20220309233752742.png" alt="image-20220309233752742"></p>
<p><img src="https://raw.githubusercontent.com/calm-always/picture/main/img/image-20220309233818875.png" alt="image-20220309233818875"></p>
<p><img src="https://raw.githubusercontent.com/calm-always/picture/main/img/image-20220309234004688.png" alt="image-20220309234004688"></p>
<h5 id="1-corePoolSize"><a href="#1-corePoolSize" class="headerlink" title="1.corePoolSize"></a>1.corePoolSize</h5><p>线程池中的常驻核心线程数。</p>
<h5 id="2-maximumPoolSize"><a href="#2-maximumPoolSize" class="headerlink" title="2.maximumPoolSize"></a>2.maximumPoolSize</h5><p>线程池能够容纳同时执行的最大线程数，此值必须大于等于1。</p>
<h5 id="3-keepAliveTime"><a href="#3-keepAliveTime" class="headerlink" title="3.keepAliveTime"></a>3.keepAliveTime</h5><p>多余的空闲线程的存活时间。当前线程池数量超过corePoolSize时，当空闲时间达到keepAliveTime值时，多余空闲线程会被销毁直到只剩下corePoolSize个线程为止。</p>
<h5 id="4-unit"><a href="#4-unit" class="headerlink" title="4.unit"></a>4.unit</h5><p>keepAliveTime的时间单位。</p>
<h5 id="5-workQueue"><a href="#5-workQueue" class="headerlink" title="5.workQueue"></a>5.workQueue</h5><p>任务队列，被提交但尚未被执行的任务。</p>
<h5 id="6-threadFactory"><a href="#6-threadFactory" class="headerlink" title="6.threadFactory"></a>6.threadFactory</h5><p>表示生成线程池中工作线程的线程工厂，用于创建线程一般用默认的即可。</p>
<h5 id="7-handler"><a href="#7-handler" class="headerlink" title="7.handler"></a>7.handler</h5><p>拒绝策略，表示当队列满了并且工作线程大于等于线程池的最大线程数（maximumPoolSize)时如何来拒绝新任务。</p>
<h4 id="四、线程池底层工作原理"><a href="#四、线程池底层工作原理" class="headerlink" title="四、线程池底层工作原理"></a>四、线程池底层工作原理</h4><p><img src="https://raw.githubusercontent.com/calm-always/picture/main/img/image-20220310000525432.png" alt="image-20220310000525432"></p>
<p><img src="https://raw.githubusercontent.com/calm-always/picture/main/img/image-20220310000628524.png" alt="image-20220310000628524"></p>
<blockquote>
<p>1.在创建了线程池后，等待提交过来的任务请求；</p>
<p>2.当调用了execute()方法添加了一个请求任务时，线程会做如下判断：</p>
<p>  2.1 如果正在运行的线程数量大于或等于corePoolSize，那么马上创建线程运行这个任务；</p>
<p>  2.2 如果正在运行的线程数量大于或等于corePoolSize，那么将这个任务放入队列；</p>
<p>  2.3 如果这时候队列满了且正在运行的线程数量还小于maximumPoolSize，那么还是要创建非核心线程立刻运行这个任务；</p>
<p>  2.4 如果队列满了且正在运行的线程数量大于或等于maximumPoolSize，那么线程池会启动饱和拒绝策略来执行。</p>
<p>3.当一个线程完成任务时，它会从队列中取下一个任务来执行。</p>
<p>4.当一个线程无事可做超过一定的时间（keepAliveTime)时，线程池会判断：</p>
<p>​    如果当前运行的线程数大于corePoolSize，那么这个线程就会被停掉；</p>
<p>​    所以线程池的所有任务完成后它最终会收缩到corePoolSize的大小。</p>
</blockquote>
<h4 id="五、线程池的四种拒绝策略"><a href="#五、线程池的四种拒绝策略" class="headerlink" title="五、线程池的四种拒绝策略"></a>五、线程池的四种拒绝策略</h4><p>等待队列已满，线程池中的线程数量也达到了maximumPoolSize，这时候就需要拒绝策略了。</p>
<h5 id="1-AbortPolicy"><a href="#1-AbortPolicy" class="headerlink" title="1. AbortPolicy"></a>1. AbortPolicy</h5><h5 id="2-CallerRunsPolicy"><a href="#2-CallerRunsPolicy" class="headerlink" title="2.CallerRunsPolicy"></a>2.CallerRunsPolicy</h5><h5 id="3-DiscardOldestPolicy"><a href="#3-DiscardOldestPolicy" class="headerlink" title="3.DiscardOldestPolicy"></a>3.DiscardOldestPolicy</h5><h5 id="4-DiscardPolicy"><a href="#4-DiscardPolicy" class="headerlink" title="4.DiscardPolicy"></a>4.DiscardPolicy</h5><h4 id="六、生产中应该使用哪种线程池"><a href="#六、生产中应该使用哪种线程池" class="headerlink" title="六、生产中应该使用哪种线程池"></a>六、生产中应该使用哪种线程池</h4><h5 id="1-不使用默认提供的线程池创建方式。默认线程池存在的问题："><a href="#1-不使用默认提供的线程池创建方式。默认线程池存在的问题：" class="headerlink" title="1.不使用默认提供的线程池创建方式。默认线程池存在的问题："></a>1.不使用默认提供的线程池创建方式。默认线程池存在的问题：</h5><p><img src="https://raw.githubusercontent.com/calm-always/picture/main/img/image-20220309233733219.png" alt="image-20220309233733219"></p>
<p><img src="https://raw.githubusercontent.com/calm-always/picture/main/img/image-20220309233752742.png" alt="image-20220309233752742"></p>
<p>newFixedThreadPool和newSingleThreadExecutor中队列为无界队列，最大值为Integer.MAX_VALUE，会堆积大量请求，导致OOM.</p>
<p><img src="https://raw.githubusercontent.com/calm-always/picture/main/img/image-20220309233818875.png" alt="image-20220309233818875"></p>
<p>CachedThreadPool允许创建数量为Integer.MAX_VALUE的线程，可能会创建大量的线程，导致OOM。</p>
<h5 id="2-根据需要手动创建"><a href="#2-根据需要手动创建" class="headerlink" title="2.根据需要手动创建"></a>2.根据需要手动创建</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService executorService = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">5</span>,</span><br><span class="line">                <span class="number">10</span>,</span><br><span class="line">                <span class="number">3L</span>,</span><br><span class="line">                TimeUnit.SECONDS,</span><br><span class="line">                <span class="keyword">new</span> LinkedBlockingQueue&lt;&gt;(<span class="number">5</span>),</span><br><span class="line">                Executors.defaultThreadFactory());</span><br></pre></td></tr></table></figure>

<h4 id="七、线程池如何配置线程数"><a href="#七、线程池如何配置线程数" class="headerlink" title="七、线程池如何配置线程数"></a>七、线程池如何配置线程数</h4><h5 id="1-CUP密集型"><a href="#1-CUP密集型" class="headerlink" title="1.CUP密集型"></a>1.CUP密集型</h5><h5 id="2-IO密集型"><a href="#2-IO密集型" class="headerlink" title="2.IO密集型"></a>2.IO密集型</h5>
            </div>
          

    
      <footer class="post-footer">
		
		<div class="post-tags">
		  
			<a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/">多线程</a>
		  
		</div>
		

        
        
  <nav class="post-nav">
    
    
      <a class="next" href="/2022/03/08/linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">
        <span class="next-text nav-default">linux常用命令</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
        2014 -
    
    2022
    <span class="footer-author">zjh.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> and <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/frostfan/hexo-theme-polarbear">Polar Bear</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

  </body>
</html>
